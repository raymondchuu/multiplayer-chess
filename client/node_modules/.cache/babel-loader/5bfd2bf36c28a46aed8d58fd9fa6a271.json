{"ast":null,"code":"import { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\n\nvar _jsxFileName = \"/Users/RaymondChu/react-chess/client/src/components/VideoCall/VideoCall.js\",\n    _s = $RefreshSig$();\n\nimport React, { useRef, useState, useEffect } from 'react';\nimport { socket } from '../../socket/socket';\nimport Peer from 'simple-peer';\nexport default function VideoCall(props) {\n  _s();\n\n  const [callAccepted, setCallAccepted] = useState(false);\n  const [stream, setStream] = useState();\n  const [receivingCall, setReceivingCall] = useState(false);\n  const [caller, setCaller] = useState(\"\");\n  const [callerSignal, setCallerSignal] = useState();\n  const userVideo = useRef();\n  const partnerVideo = useRef();\n  useEffect(() => {\n    navigator.mediaDevices.getUserMedia({\n      video: true,\n      audio: true\n    }).then(stream => {\n      setStream(stream);\n\n      if (userVideo.current) {\n        userVideo.current.srcObject = stream;\n      }\n    });\n    socket.on(\"hello\", data => {\n      setReceivingCall(true);\n      setCaller(data.from);\n      setCallerSignal(data.signal);\n    });\n  });\n\n  function callPeer(username) {\n    const peer = new Peer({\n      initiator: true,\n      trickle: false,\n      stream: stream\n    });\n    peer.on(\"signal\", data => {\n      socket.emit(\"callUser\", {\n        userToCall: username,\n        signalData: data,\n        from: props.username,\n        gameId: props.gameId\n      });\n    });\n    peer.on(\"stream\", stream => {\n      if (partnerVideo.current) {\n        partnerVideo.current.srcObject = stream;\n      }\n    });\n    socket.on(\"callAccepted\", signal => {\n      setCallAccepted(true);\n      peer.signal(signal);\n    });\n  }\n\n  function acceptCall() {\n    setCallAccepted(true);\n    const peer = new Peer({\n      initiator: false,\n      trickle: false,\n      stream: stream\n    });\n    peer.on(\"signal\", data => {\n      socket.emit(\"acceptCall\", {\n        signal: data,\n        to: caller,\n        gameId: props.gameId\n      });\n    });\n    peer.on(\"stream\", stream => {\n      partnerVideo.current.srcObject = stream;\n    });\n    peer.signal(callerSignal);\n  }\n\n  var UserVideo;\n\n  if (stream) {\n    userVideo = /*#__PURE__*/_jsxDEV(\"video\", {\n      playsInline: true,\n      ref: userVideo,\n      autoplay: true\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 76,\n      columnNumber: 13\n    }, this);\n  }\n\n  var PartnerVideo;\n\n  if (callAccepted) {\n    PartnerVideo = /*#__PURE__*/_jsxDEV(\"video\", {\n      playsInline: true,\n      ref: partnerVideo,\n      autoPlay: true\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 83,\n      columnNumber: 9\n    }, this);\n  }\n\n  var incomingCall;\n\n  if (receivingCall) {\n    incomingCall = /*#__PURE__*/_jsxDEV(\"div\", {\n      children: [/*#__PURE__*/_jsxDEV(\"h1\", {\n        children: [caller, \" is calling you\"]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 91,\n        columnNumber: 11\n      }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n        onClick: acceptCall,\n        children: \"Accept\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 92,\n        columnNumber: 11\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 90,\n      columnNumber: 9\n    }, this);\n  }\n\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    children: [/*#__PURE__*/_jsxDEV(\"div\", {\n      children: [UserVideo, PartnerVideo]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 99,\n      columnNumber: 13\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      children: props.allUsers.map(name => {\n        if (name !== props.username) {\n          return /*#__PURE__*/_jsxDEV(\"button\", {\n            onClick: () => callPeer(name),\n            children: [\"Call \", name]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 106,\n            columnNumber: 32\n          }, this);\n        }\n      })\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 103,\n      columnNumber: 13\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      children: incomingCall\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 110,\n      columnNumber: 13\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 98,\n    columnNumber: 9\n  }, this);\n}\n\n_s(VideoCall, \"BA2+aTCrx41BVCbf2a0tdYE5Erk=\");\n\n_c = VideoCall;\n\nvar _c;\n\n$RefreshReg$(_c, \"VideoCall\");","map":{"version":3,"sources":["/Users/RaymondChu/react-chess/client/src/components/VideoCall/VideoCall.js"],"names":["React","useRef","useState","useEffect","socket","Peer","VideoCall","props","callAccepted","setCallAccepted","stream","setStream","receivingCall","setReceivingCall","caller","setCaller","callerSignal","setCallerSignal","userVideo","partnerVideo","navigator","mediaDevices","getUserMedia","video","audio","then","current","srcObject","on","data","from","signal","callPeer","username","peer","initiator","trickle","emit","userToCall","signalData","gameId","acceptCall","to","UserVideo","PartnerVideo","incomingCall","allUsers","map","name"],"mappings":"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","sourcesContent":["import React, { useRef, useState, useEffect } from 'react';\nimport { socket } from '../../socket/socket';\nimport Peer from 'simple-peer';\n\nexport default function VideoCall(props) {\n    const [callAccepted, setCallAccepted] = useState(false);\n    const [stream, setStream] = useState();\n    const [receivingCall, setReceivingCall] = useState(false);\n    const [caller, setCaller] = useState(\"\");\n    const [callerSignal, setCallerSignal] = useState();\n\n    const userVideo = useRef();\n    const partnerVideo = useRef();\n\n    useEffect(() => {\n        navigator.mediaDevices.getUserMedia({ video: true, audio: true })\n        .then((stream) => {\n            setStream(stream);\n            if (userVideo.current) {\n                userVideo.current.srcObject = stream;\n            }\n        })\n\n        socket.on(\"hello\", (data) => {\n            setReceivingCall(true);\n            setCaller(data.from);\n            setCallerSignal(data.signal);\n        })\n    });\n\n    function callPeer(username) {\n        const peer = new Peer({\n            initiator: true,\n            trickle: false,\n            stream: stream,\n        });\n\n        peer.on(\"signal\", data => {\n            socket.emit(\"callUser\", { userToCall: username, signalData: data, from: props.username, gameId: props.gameId })\n        });\n\n        peer.on(\"stream\", stream => {\n            if (partnerVideo.current) {\n                partnerVideo.current.srcObject = stream;\n            }\n        });\n\n        socket.on(\"callAccepted\", signal => {\n            setCallAccepted(true);\n            peer.signal(signal);\n        });\n    }\n\n    function acceptCall() {\n        setCallAccepted(true);\n        const peer = new Peer({\n            initiator: false,\n            trickle: false,\n            stream: stream,\n        });\n\n        peer.on(\"signal\", data => {\n            socket.emit(\"acceptCall\", { signal: data, to: caller, gameId: props.gameId});\n        });\n\n        peer.on(\"stream\", stream => {\n            partnerVideo.current.srcObject = stream;\n        });\n\n        peer.signal(callerSignal); \n    }\n\n    var UserVideo;\n    if (stream) {\n        userVideo = (\n            <video playsInline ref={userVideo} autoplay />\n        );\n    }\n\n    var PartnerVideo;\n    if (callAccepted) {\n      PartnerVideo = (\n        <video playsInline ref={partnerVideo} autoPlay />\n      );\n    }\n  \n    var incomingCall;\n    if (receivingCall) {\n      incomingCall = (\n        <div>\n          <h1>{caller} is calling you</h1>\n          <button onClick={acceptCall}>Accept</button>\n        </div>\n      )\n    }\n\n    return(\n        <div>\n            <div>\n                {UserVideo}\n                {PartnerVideo}\n            </div>\n            <div>\n                {props.allUsers.map(name => {\n                    if (name !== props.username) {\n                        return <button onClick={() => callPeer(name)}>Call {name}</button>\n                    }\n                })}\n            </div>\n            <div>\n                {incomingCall}\n            </div>\n        </div>\n    );\n}"]},"metadata":{},"sourceType":"module"}